<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/ueditor.all.min.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/lang/zh-cn/zh-cn.js"></script>
<script src="__PUBLIC__/ace/assets/js/jquery-1.10.2.min.js"></script>
<div class="breadcrumbs" id="breadcrumbs">
  <script type="text/javascript">
    try {
      ace.settings.check('breadcrumbs', 'fixed')
    } catch (e) {
    }
    var ue = UE.getEditor('desc',{
                toolbars: [
                    ['fullscreen', 'source', 'undo', 'redo', 'bold','italic','selectall','removeformat','unlink','cleardoc','fontfamily','fontsize','forecolor',]
                ],
                autoHeightEnabled: false,
                autoFloatEnabled: true
            });
    var ue_back = UE.getEditor('background',{
                toolbars: [
                    ['fullscreen', 'source', 'undo', 'redo', 'bold','italic','selectall','removeformat','unlink','cleardoc','fontfamily','fontsize','forecolor',]
                ],
                autoHeightEnabled: false,
                autoFloatEnabled: true
            });
  </script>

  <!-- <ul class="breadcrumb">
    <li>
      <i class="icon-home home-icon"></i>
      <a href="#">对抗题</a>
    </li>
    <li class="active">添加</li>
  </ul> --><!-- .breadcrumb -->
</div>

<div class="page-content">

  <div class="row">
    <div class="col-xs-12">
      <!-- PAGE CONTENT BEGINS -->
      <form class="form-horizontal" role="form" action="../TargetExamination/edit" method="post" onsubmit="return sub();">
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">题库类型: </label>
          <div class="col-sm-9">
            <input type="text" id="form-field-1" class="col-xs-10 col-sm-5" value="靶场题" disabled>
          </div>
        </div>
         <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">对抗靶场: </label>
          <div class="col-sm-9">
              <input type="text" id="target" name="target" class="col-xs-10 col-sm-5" value="{$info.question}">
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">靶机: </label>
          <div class="col-sm-9">
            window<input type="checkbox" name="target" value="1">
            linux<input type="checkbox" name="target" value="2">
            macos<input type="checkbox" name="target" value="3">
          </div>
        </div>
        <hr/>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">说明: </label>
          <div class="col-sm-9">
             <script id="desc" name="desc" type="text/plain" style="margin-left:0px;">

            </script>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">题目: </label>
          <div class="col-sm-9">
            <input type="text" id="question" name="question" class="col-xs-10 col-sm-5" value="" />
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">分数: </label>
          <div class="col-sm-9">
            <input type="text" id="score" class="col-xs-10 col-sm-5" name="score" value=""/>
          </div>
        </div>
        <input type="hidden" id="id"  name="id" value="{$info['resistcomp_id']}"/>
        <input type="hidden" id="type" name="type" value="{$type}"/>
        <input type="hidden" id="ans" name="ans" value=""/>
        <input type="hidden" id="targetids" name="targetids" value=""/>
        <div class="clearfix form-actions">
          <div class="col-md-offset-3 col-md-9">
            <button class="btn btn-info" type="button" onclick="sub(2);">
              <i class="icon-ok bigger-110"></i> 确定
            </button>
            <button class="btn btn-info" type="button" onclick="sub(4);">
              <i class="icon-ok bigger-110"></i> 取消
            </button>
          </div>
        </div>
        
      </form>
      <!-- PAGE CONTENT ENDS -->
    </div><!-- /.col -->
  </div>
</div><!-- /.page-content -->
<script type="text/javascript">
$(document).ready(function(){
});
function del(deid){
	var url = "../ResistExamination/del";
	//var tmp = window.confirm("确定执行该操作吗");
	//if(tmp === true){
		$.post(url,{deid:deid},function(data){
			if(data.status == "1"){
				alert(data.info);
				window.location.reload();
			}else{
				alert(data.info);
			}
		});
	//}
	//return false;
}
function sub(savetype){
  if(savetype == 4){
    window.location.href="{:U('ResistExamination/getlist')}";
    return false;
  }
  var ue = UE.getEditor('desc');
  if(!ue.hasContents()){
      alert("说明不能为空");
      return false;
   }else{
      var desc = ue.getContent();
   }
  var ue_back = UE.getEditor('background');
  if(!ue_back.hasContents()){
      alert("背景不能为空");
      return false;
   }else{
      var background = ue_back.getContent();
   }
	var ans = '';
	$("input[name*='item']").each(function(){
		ans +=$(this).val() + "@@"; 
	});
	$("#ans").val(ans);
	var targetids = '';
	$("input[name='target']:checked").each(function(){
		targetids +=$(this).val()+",";
	});
	$("#targetids").val(targetids);
	//var desc = $("#desc").val();
	
	//var background = $("#background").val();
	var question = $.trim($("#question").val());
    //if(question == "") return alert("关卡题目不能为空");
	var score = $.trim($("#score").val());
    if(parseInt(score) != score) return alert("分数必须为整数");
	var typeid = $("#typeid").val();
	var id = $("#id").val();
	var type = $("#type").val();
	var typeid = $("#typeid").val();
	var target = $.trim($("#target").val());
    if(target == "") return alert("对抗靶场不能为空");

	var url = "../ResistExamination/edit";
	$.post(url,{target:target,targetids:targetids,savetype:savetype,ans:ans,desc:desc,background:background,question:question,score:score,type:type,id:id,typeid:typeid},function(data){
		if(data.status == "1"){
			alert(data.info);
			window.location.href=data.data;
		}else{
			alert(data.info);
		}
	});
}
</script>
