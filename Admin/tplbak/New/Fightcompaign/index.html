<div id="right">
  <div id="search">
    <form method="post" name="form_search">
      比赛名称：<input type="text" name="competition" value="">
      <img src="__PUBLIC__/admin/images/search.png" onclick="form_search.submit()">
    </form>
  </div>
  <div class="tijiawanigahnegg">
    <a href="{:U('Fightcompaign/add')}"><h2>新建</h2></a>
    <!-- <a href="javascript:deleteids();"><h2>删除</h2></a> -->
  </div>
  <table>
    <tr>
      <td></td>
      <td>对抗靶场名称</td>
      <td>靶场数(类)</td>
      <td>比赛时间</td>
      <td>团队数</td>
      <td>比赛进度</td>
      <td>比赛管理</td>
      <td>靶机管理</td>
      <td>成绩管理</td>
    </tr>
    <?php foreach($list as $val):?>
    <tr>
      <td><input type="checkbox"  id="<?php echo $val['competition_id'];?>" name="list_check"></td>
      <td><?php echo $val['competition_name'];?></td>
      <td><?php echo $val['target_numbers'];?>个</td>
      <td><?php echo $val['starttime'];?>~<?php echo$val['endtime'];?></td>
      <td><a href="{:U('Fightcompaign/set_competition_teams')}?id=<?php echo $val['competition_id'];?>"><?php echo $val['team_numbers'];?>个</a></td>
      <td><?php echo $val['schedule'];?></td>
      <td><a href="{:U('Fightcompaign/add')}?id=<?php echo $val['competition_id'];?>">修改</a>
        &nbsp;&nbsp;<a href="javascript:void(0);" onclick="del({$val['competition_id']})">删除</a></td>
      <td><a href="{:U('Fightcompaign/vmslist',array('id'=>$val['competition_id']))}">管理</td>
      <td><a href="{:U('Score/export',array('id'=>$val['competition_id'],'type'=>2))}">导出</a></td>
    </tr>
    <?php endforeach;?>
    <td><td colspan="9">{$page}</td></tr>
  </table>
</div>
<div id="footerright">
  <ul>
  </ul>
</div>
<script type="text/javascript">
function del(id){
    var tmp = window.confirm("温馨提示：删除该条数据前，请先点击该行后面的 ‘管理’ 按钮来始化虚拟机，以便删除对应的虚拟机。如果您已经初始化过，请点击确定。");
    if(tmp === false) return false;
    if(id == ''){
        return alert("参数错误");
    }
    var url = "{:U('Fightcompaign/delete')}";
    $.get(url,{id:id},function(data){
        if(data.status===1){
            alert("ok");
            window.location.reload();
        }else{
            alert("delete failed");
        }
    });
}
function deleteids(){
    var tmp = window.confirm("确定要删除这些吗？");
    if(tmp === false) return false;
    var ids = '';
    $("input[name='list_check']:checked").each(function(m,o){
        var id = ''; 
        id = $(this).attr("id");
        if(id != '') ids += id+",";
    }); 
    if(ids == ''){
        return alert("您还没选择要删除的项");
    }
    var url = "{:U('Fightcompaign/deleteids')}";
    $.post(url,{ids:ids},function(data){
            if(data.status == 1){
                alert(data.info);
                window.location.reload();
            }else{
                alert(data.info);
            }
    });

}

</script>
