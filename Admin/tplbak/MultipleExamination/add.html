<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/ueditor.all.min.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/uediter/lang/zh-cn/zh-cn.js"></script>
<script src="__PUBLIC__/ace/assets/js/jquery-1.10.2.min.js"></script>
<div class="breadcrumbs" id="breadcrumbs">
  <script type="text/javascript">
    try {
      ace.settings.check('breadcrumbs', 'fixed')
    } catch (e) {
    }
    var ue = UE.getEditor('desc',{
                toolbars: [
                    ['fullscreen', 'source', 'undo', 'redo', 'bold','italic','selectall','removeformat','unlink','cleardoc','fontfamily','fontsize','forecolor',]
                ],
                autoHeightEnabled: false,
                autoFloatEnabled: true
            });
    var ue_back = UE.getEditor('background',{
                toolbars: [
                    ['fullscreen', 'source', 'undo', 'redo', 'bold','italic','selectall','removeformat','unlink','cleardoc','fontfamily','fontsize','forecolor',]
                ],
                autoHeightEnabled: false,
                autoFloatEnabled: true
            });
  </script>

  <!-- <ul class="breadcrumb">
    <li>
      <i class="icon-home home-icon"></i>
      <a href="#">多选题</a>
    </li>
    <li class="active">添加</li>
  </ul> --><!-- .breadcrumb -->
</div>

<div class="page-content">

  <div class="row">
    <div class="col-xs-12">
      <!-- PAGE CONTENT BEGINS -->
      <form class="form-horizontal" role="form" action="../MultipleExamination/edit" method="post" onsubmit="return sub();">
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">题库类型: </label>
          <div class="col-sm-9">
            <input type="text" id="form-field-1" class="col-xs-10 col-sm-5" value="多选题" disabled>
          </div>
        </div>
         <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">子类: </label>
          <div class="col-sm-9">
            <select name="typeid" id="typeid">
            	<option value="">--请选择--</option>
                <foreach name="banklist" item="val" key="k">
            	<if condition="$info['bank_type_id'] eq $k ">
                <option value="{$k}" selected>{$val}</option>
                <else/>
                <option value="{$k}">{$val}</option>
                </if>
                </foreach>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">说明: </label>
          <div class="col-sm-9">
            <script id="desc" type="text/plain" style="margin-left:0px;">
            {$info['mulchoice_desc']}
            </script>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">背景: </label>
          <div class="col-sm-9">
            <script id="background"  type="text/plain" style="margin-left:0px;">
{$info['background']}
            </script>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">题目: </label>
          <div class="col-sm-9">
            <input type="text" id="question" name="question" class="col-xs-10 col-sm-5" value="{$info.question}"/>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">分数: </label>
          <div class="col-sm-9">
            <input type="text" id="score" class="col-xs-10 col-sm-5" name="score" value="{$info.score}"/>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label no-padding-right" for="form-field-1">答案: </label>
          <div class="col-sm-9" style="margin-top:5px;">点击多选 确认正确答案</div>
          <div class="col-sm-9" style="margin-left:25%;margin-top:5px;"></div>
          <div id="questionarea">
            <if condition="$type eq 'add'">
          	<div id="item" name="item">
		         <label class="col-sm-3 control-label no-padding-right" for="form-field-1">A</label>
		         <div class="col-sm-9" style="margin-top:5px;">
		           <input type="text" id="form-field-1" class="col-xs-10 col-sm-5" name="item1"/> 
		           <span name="op" data-id="1" >删除</span>&nbsp;<span name="op" data-id="2">添加</span> 
		           <input type="checkbox" value="1" style="width:18px;height:18px;margin-left:10px;"/>
		         </div>
	         </div>
	         <elseif condition="$type eq 'edit'"/>
	         	<foreach item="vl" name="answers" key="k">
		          <div id="item" name="item">
			         <label class="col-sm-3 control-label no-padding-right" for="form-field-1">{$rightarr[$k]}</label>
			         <div class="col-sm-9" style="margin-top:5px;">
			           <input type="text" id="form-field-1" class="col-xs-10 col-sm-5" name="item{$k}" value="{$vl}"/>
			           <span name="op" data-id="1" >删除</span>&nbsp;<span name="op" data-id="2">添加</span>
			           <input type="checkbox" value="{$k}" <php>if(stripos($info['right_answers'],$rightarr[$k]) !== false){</php>checked<php>}</php> style="width:18px;height:18px;margin-left:10px;"/>
			         </div>
		         </div>
	         	</foreach>
	         </if>
          </div>
        </div>
        <input type="hidden" id="background1"  name="background" value=""/>
        <input type="hidden" id="desc1"  name="desc" value=""/>
        <input type="hidden" id="id"  name="id" value="{$info.multiple_id}"/>
        <input type="hidden" id="type" name="type" value="{$type}">
        <input type="hidden" id="ans" name="ans" value="{$info.ans}"/>
        <div class="clearfix form-actions">
          <div class="col-md-offset-3 col-md-9">
            <button class="btn btn-info" type="submit">
              <i class="icon-ok bigger-110"></i> 提交
            </button>
          </div>
        </div>
        
      </form>
      <!-- PAGE CONTENT ENDS -->
    </div><!-- /.col -->
  </div>
</div><!-- /.page-content -->
<script type="text/javascript">
$(document).ready(function(){
	$("span[name='op']").bind("click",function(){
		var obj = $(this);
		var typeid = obj.attr("data-id");
		var len = $("#questionarea > div").length;

		if(len >= 6 || len < 1){
			alert("最多添加6个选项，最少添加1个选项。");
			return false;
		}
		var nextlen = parseInt(len) + 1;
		var nextname='';
		switch(nextlen){
			case 2:nextname="B";break;
			case 3:nextname="C";break;
			case 4:nextname="D";break;
			case 5:nextname="E";break;
			case 6:nextname="F";break;
		}
		if(typeid == 1){
			$("#questionarea > div").last().remove();
		}else{
			$("#questionarea > div").last().clone(true).appendTo($("#questionarea"));
		}
		$("#questionarea > div").last().find("label").html(nextname).parent().find("input").first().attr("name","item"+nextlen).val("").parent().find("input").last().attr("name","rightans-"+nextlen).val(nextlen);
		
	});
})

function sub(){
  var ue = UE.getEditor('desc');
  if(!ue.hasContents()){
      alert("说明不能为空");
      return false;
   }else{
      $("#desc1").val(ue.getContent());
   }
  var ue_back = UE.getEditor('background');
  if(!ue_back.hasContents()){
      alert("背景不能为空");
      return false;
   }else{
      $("#background1").val(ue_back.getContent());
   }
	var ans = "";
	$("input[type='checkbox']:checked").each(function(m,o){
		var tmp = '';
		var tmpid = $(this).val();
		switch(parseInt(tmpid)){
			case 1:tmp="A";break;
			case 2:tmp="B";break;
			case 3:tmp="C";break;
			case 4:tmp="D";break;
			case 5:tmp="E";break;
			case 6:tmp="F";break;
		}
		ans +=tmp+",";
	});
	$("#ans").val(ans);
    var score = $.trim($("#score").val());
    if(parseInt(score) != score){
        alert("分数必须为整数");
        return false;
    }
    return true;
	/*
	var desc = $("#desc").val();
	
	var background = $("#background").val();
	var question = $("#question").val();
	var score = $("#score").val();
	var bankid = $("#bankid").val();
	var id = $("#id").val();
	var type = $("#type").val();
	var typeid = $("#typeid").val();
	var url = "../MultipleExamination/edit";
	$.post(url,{ans:ans,desc:desc,background:background,question:question,score:score,type:type,id:id,typeid:typeid},function(data){
		if(data.status == "1"){
			alert(data.info);
			//window.location.href="../MultipleExamination/getlist";
		}else{
			alert(data.info);
		}
	});
	*/
}
</script>
